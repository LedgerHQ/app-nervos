
. ./tests/lib.sh

@test "Signing APDU rejects when given garbage to sign and strict checking is enabled." {
  run apdu_fixed "8003c0000400001111"
  [ "$status" -eq 0 ]
  grep -q "<= b''9405" <(echo "$output")
  echo $output
}

# This a self transfer transaction with signing path "m/44'/309'/0'/0/0"

@test "Signing with strict checking and a valid useful transaction passes" {
  run sendTransaction 940500001800000030000000480000004c00000080050000050000002c00008035010080000000800000000000000000050000002c0000803501008000000080000000000000000002000000340500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d140000000c000000100000000000000000000000140000000c000000100000000000000000000000
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  txhash_and_witness=21f34fded754e349b5d088c197f7ee091213cfc9e6198639ba5a0359b8952de65500000000000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  run check_signature "" "$txhash_and_witness" "$rv"
  diff <(echo $output) - <<<"Signature Verified Successfully"
}

# Signing a valid transaction: From account 'm/44'/309'/0'', change 'm/44'/309'/0'/1/1'
# Transaction:
# version: 0
# cell_deps:
#   - out_point:
#       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
#       index: 0
#     dep_type: dep_group
# header_deps: []
# inputs:
#   - since: 0x0 (absolute block(0))
#     previous_output:
#       tx_hash: 0x39641a05511b85d641cc844d0e0e7766983c9a26b1d62d51f251de7125390b16
#       index: 1
# outputs:
#   - capacity: "200.0"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0xf941fd7b5f5ef376561a32d0c5b0bb1cd11802d6
#       hash_type: type
#     type: ~
#   - capacity: "599.998"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x71882946c87d62f9b2f2b5be3be6b5c2704fec59
#       hash_type: type
#     type: ~
# outputs_data:
#   - 0x
#   - 0x
# witnesses:
#   - 0x5500000010000000550000005500000041000000469b74c4927b197ae270f68553dec8b900ff400498b78d697b2f94ab8e90a60e1a3182a3ece72f14c9838dd36a98a8871b600a8a5bc3c4ae73ed6cb0c03d1e2700
# hash: 0xfac70fd2f895c64e60db9dd895427209852841e443eb39bbb13d4bc81ac35261

@test "Signing a valid transaction: From account 'm/44'/309'/0'', change 'm/44'/309'/0'/1/1'" {
  run sendTransaction 260300001800000030000000480000004c0000001a030000050000002c00008035010080000000800100000001000000050000002c0000803501008000000080010000000100000001000000ce0200001c00000020000000490000004d000000ec010000ba020000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000009f01000008000000970100000c00000038000000000000000000000039641a05511b85d641cc844d0e0e7766983c9a26b1d62d51f251de7125390b16010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000001000000000000000000000039738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad00000000ce0000000c0000006d0000006100000010000000180000006100000000c817a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000f941fd7b5f5ef376561a32d0c5b0bb1cd11802d66100000010000000180000006100000060995da012000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec59140000000c000000100000000000000000000000ce0000000c0000006d0000006100000010000000180000006100000000c817a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000f941fd7b5f5ef376561a32d0c5b0bb1cd11802d661000000100000001800000061000000c04a44f80d000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec59140000000c0000001000000000000000000000000c0000000800000000000000
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  # TODO: do signature checking
  if [ ${#rv} != 133 ];
  then
    echo "Signature not correct length"
    exit 1
  fi
}

# "Signing a valid self transfer transaction"
# Created using this command
# wallet transfer --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0 --to-address ckt1qyqqtw74sngmqqqzauwulk6e3rc0l46gmuxqptn8pr --capacity 3750 --tx-fee 0.001  --derive-change-address ckt1qyqqtw74sngmqqqzauwulk6e3rc0l46gmuxqptn8pr  --derive-receiving-address-length 3 --derive-change-address-length 3

# Transaction 
# version: 0
# cell_deps:
#   - out_point:
#       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
#       index: 0
#     dep_type: dep_group
# header_deps: []
# inputs:
#   - since: 0x0 (absolute block(0))
#     previous_output:
#       tx_hash: 0x2e4f4999bc2ae5d1bf1964d1fb4fa2d7c9dff014faa0fb4130fcaf053a828b6b
#       index: 0
# outputs:
#   - capacity: "3750.0"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x05bbd584d1b00002ef1dcfdb5988f0ffd748df0c
#       hash_type: type
#     type: ~
#   - capacity: "2249.999"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x05bbd584d1b00002ef1dcfdb5988f0ffd748df0c
#       hash_type: type
#     type: ~
# outputs_data:
#   - 0x
#   - 0x
# witnesses:
#   - 0x5500000010000000550000005500000041000000323da15393fc3aaf7be44436fbad50d1b663d99d4f387e61eec7054828aab2b272664dab2b9cbaf07dbeccf38746669ae8d27a3a8ffc60e3d891366ffeee218901
# hash: 0x32e63801a2a67840be36a31f42056e6f4ef0400548e39cc0311bcd93d648f976

@test "Signing a valid self transfer transaction" {
  run sendTransaction 260300001800000030000000480000004c0000001a030000050000002c00008035010080000000800000000003000000050000002c0000803501008000000080000000000300000001000000ce0200001c00000020000000490000004d000000ec010000ba020000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000009f01000008000000970100000c0000003800000000000000000000002e4f4999bc2ae5d1bf1964d1fb4fa2d7c9dff014faa0fb4130fcaf053a828b6b000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000004f26933c260b39c605b4fe848f506459d97f3f7a3b4c1a3de80b026dd7a3111401000000ce0000000c0000006d000000610000001000000018000000610000000070c9b28b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c610000001000000018000000610000006003d7c0166bc11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000ce0000000c0000006d0000006100000010000000180000006100000000e6bd4f57000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c6100000010000000180000006100000060030a6334000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c140000000c0000001000000000000000000000000c0000000800000000000000
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  # TODO: do signature checking
  if [ ${#rv} != 133 ];
  then
    echo "Signature not correct length"
    exit 1
  fi
}

# "Signing a valid transaction: From account 'm/44'/309'/0'/0/2', and same change path"
# From and change address are same
# wallet transfer --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0 --to-address ckt1qyq2yksyd5g6jkumltkrx35qvz6hdlypatlsz7agpy --capacity 1560 --tx-fee 0.001  --derive-change-address  ckt1qyqxt33570n599su3f88zxg38zn3ae00jkgsawek56 --derive-receiving-address-length 2 --derive-change-address-length 2

# Transaction 
# version: 0
# cell_deps:
#   - out_point:
#       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
#       index: 0
#     dep_type: dep_group
# header_deps: []
# inputs:
#   - since: 0x0 (absolute block(0))
#     previous_output:
#       tx_hash: 0x4f26933c260b39c605b4fe848f506459d97f3f7a3b4c1a3de80b026dd7a31114
#       index: 0
# outputs:
#   - capacity: "1560.0"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0xa25a046d11a95b9bfaec33468060b576fc81eaff
#       hash_type: type
#     type: ~
#   - capacity: "439.999"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x65c634f3e742961c8a4e71191138a71ee5ef9591
#       hash_type: type
#     type: ~
# outputs_data:
#   - 0x
#   - 0x
# witnesses:
#   - 0x5500000010000000550000005500000041000000b8f6b3ba613906b354dafa9423af8c534141c20fa343e3ef3c7054729b7b14ff4b2510b774d9ededc299e5181b5ff8acf8bc6c874c99b544ca513b52b87d5f7400
# hash: 0x23901dc31e18374f9a088f0033dcca6122f4e3646808c2e8b25983c4807e66b7

@test "Signing a valid transaction: From account 'm/44'/309'/0'/0/2', and same change path" {
  run sendTransaction 260300001800000030000000480000004c0000001a030000050000002c00008035010080000000800000000002000000050000002c0000803501008000000080000000000200000001000000ce0200001c00000020000000490000004d000000ec010000ba020000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000009f01000008000000970100000c0000003800000000000000000000004f26933c260b39c605b4fe848f506459d97f3f7a3b4c1a3de80b026dd7a31114000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000010000000000000000000000be3abd7565dd5e106a454368d7acec71c7a5114121d9dfe07ad54c48434f615c01000000ce0000000c0000006d0000006100000010000000180000006100000000d0ed902e000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef95916100000010000000180000006100000000faa173a26bc11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000ce0000000c0000006d000000610000001000000018000000610000000018535224000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000a25a046d11a95b9bfaec33468060b576fc81eaff610000001000000018000000610000006031993e0a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef9591140000000c0000001000000000000000000000000c0000000800000000000000
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  # TODO: do signature checking
  if [ ${#rv} != 133 ];
  then
    echo "Signature not correct length"
    exit 1
  fi
}

# "Signing a valid transaction: From account 'm/44'/309'/0'/0/4', and change path 'm/44'/309'/0'/1/5'"
# wallet transfer --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0 --to-address ckt1qyq8rzpfgmy86chektett03mu66uyuz0a3vskk4eel --capacity 1400 --tx-fee 0.001  --derive-change-address ckt1qyqxyt6gphlcwvw3tjpj6g35ae8da5x0uwvqrprflz  --derive-receiving-address-length 4 --derive-change-address-length 5

# Transaction
# version: 0
# cell_deps:
#   - out_point:
#       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
#       index: 0
#     dep_type: dep_group
# header_deps: []
# inputs:
#   - since: 0x0 (absolute block(0))
#     previous_output:
#       tx_hash: 0xf44b26dda9f1f48b20029654be67c2e636b7fec62b877e20b695c2307dae4a52
#       index: 0
# outputs:
#   - capacity: "1400.0"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x71882946c87d62f9b2f2b5be3be6b5c2704fec59
#       hash_type: type
#     type: ~
#   - capacity: "99.999"
#     lock:
#       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
#       args: 0x622f480dff8731d15c832d2234ee4eded0cfe398
#       hash_type: type
#     type: ~
# outputs_data:
#   - 0x
#   - 0x
# witnesses:
#   - 0x550000001000000055000000550000004100000097e3118c185ead9ca04f85380fba25b796ef849a01a321a13e921c725a85b8e772eab6ce0ab4982b38a895026ed09a2f634c4aca3849e288099921b72566657e01
# hash: 0x4dbfe46d45f2330a661ec7bbf439aa5ba2cf6a39149ba1c85c47963e706837d6

@test "Signing a valid transaction: From account 'm/44'/309'/0'/0/4', and change path 'm/44'/309'/0'/1/5'" {
  run sendTransaction 260300001800000030000000480000004c0000001a030000050000002c00008035010080000000800000000004000000050000002c0000803501008000000080010000000500000001000000ce0200001c00000020000000490000004d000000ec010000ba020000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000009f01000008000000970100000c000000380000000000000000000000f44b26dda9f1f48b20029654be67c2e636b7fec62b877e20b695c2307dae4a52000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000002e4f4999bc2ae5d1bf1964d1fb4fa2d7c9dff014faa0fb4130fcaf053a828b6b01000000ce0000000c0000006d00000061000000100000001800000061000000005cb2ec22000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000004c73d21a2cd6501255bf410dcab0265c2ee1fdcb61000000100000001800000061000000c02023d4f36ac11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000ce0000000c0000006d000000610000001000000018000000610000000078a69820000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec5961000000100000001800000061000000605d0a5402000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c0000001000000000000000000000000c0000000800000000000000
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  # TODO: do signature checking
  if [ ${#rv} != 133 ];
  then
    echo "Signature not correct length"
    exit 1
  fi
}

@test "Signing with strict checking and an incorrect context fails" {
  run apdu_fixed "8003400011048000002c800001358000000080000000"
  [ "$status" -eq 0 ]
  grep -q "<= b''9000" <(echo "$output")

  run sendTransaction "940500001800000030000000480000004c00000080050000050000002c00008035010080000000800000000000000000050000002c0000803501008000000080000000000000000002000000340500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c661436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d140000000c000000100000000000000000000000140000000c000000100000000000000000000000" --expectReject
  grep -q "<= b''9405" <(echo "$output")
  hardRejectionMessageCheck "Context transaction does not match hash"
}

@test "Signing with strict checking of a transaction having a type script fails" {
  run apdu_fixed "8003400011048000002c800001358000000080000000"
  [ "$status" -eq 0 ]
  grep -q "<= b''9000" <(echo "$output")
  run sendTransaction d10500001800000030000000480000004c000000bd050000050000002c00008035010080000000800000000000000000050000002c0000803501008000000080000000000000000002000000710500001c000000200000006e0000007200000052040000550500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000083d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e010000000061000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c0000001800000008000000000000000000000000000000140000000c000000100000000000000000000000 --expectReject
  grep -q "<= b''6982" <(echo "$output")
  rejectionMessageCheck "Only the DAO type script is supported" 2
}

@test "Signing with a transaction having a type script outside of strict checking prompts with a hash" {
  run apdu_fixed "8003400011048000002c800001358000000080000000"
  [ "$status" -eq 0 ]
  grep -q "<= b''9000" <(echo "$output")
  run sendTransaction d10500001800000030000000480000004c000000bd050000050000002c00008035010080000000800000000000000000050000002c0000803501008000000080000000000000000002000000710500001c000000200000006e0000007200000052040000550500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000083d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e010000000061000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c0000001800000008000000000000000000000000000000140000000c000000100000000000000000000000 --no-hard-check
  promptsCheck 2 tests/sign-unsafe-prompts.txt
}

@test "Signing with strict checking and a different change address passes." {

  run sendTransaction 90050000180000003000000044000000480000007c050000050000002c00008035010080000000800000000000000000040000002c00008035010080010000800100008002000000340500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000b690f63b6fca7abff77c558bffa7401ec40dcb52140000000c000000100000000000000000000000140000000c000000100000000000000000000000
  promptsCheck 4 tests/sign-with-change-path.txt
  rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
  txhash_and_witness=56aa7721f93350b942333b389fbdf062d5a5ad86cabe7cb20f7c00bab2d09baf5500000000000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  run check_signature "" "$txhash_and_witness" "$rv"
  diff <(echo $output) - <<<"Signature Verified Successfully"
}

@test "Signing with strict checking and more than one destination fails" {
  run sendTransaction 90050000180000003000000044000000480000007c050000050000002c00008035010080000000800000000000000000040000002c00008035010080010000800200008002000000340500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000b690f63b6fca7abff77c558bffa7401ec40dcb52140000000c000000100000000000000000000000140000000c000000100000000000000000000000 --expectReject
  [ "$status" -eq 0 ]
  grep -q "<= b''6982" <(echo "$output")
  rejectionMessageCheck "Can't handle transactions with multiple non-change destination addresses"
}

@test "Signing with strict checking, a plain transfer, and data in an output cell fails" {
  run sendTransaction 980500001800000030000000480000004c00000084050000050000002c0000803501008000000080000000000000000005000000001c000000200000006e000000b2000000e2000002000000380500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d180000000c0000001400000004000000deadbeef00000000140000000c000000100000000000000000000000
  [ "$status" -eq 0 ]
  grep -q "<= b''6982" <(echo "$output")
  rejectionMessageCheck "Data found in non-dao cell"
}

@test "Signing with strict checking, a plain transfer, and data in an output cell fails even with eight bytes of data" {
  run sendTransaction 9c0500001800000030000000480000004c00000088050000050000002c000080350100800000008000000000000000000500000001c4000001b80000001c000000200000006e0000020000003c0500001c000000200000006e0000007200000052040000200500000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000100000000e00300000c00000051020000450200000c000000380000000000000000000000b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d5010000000d0200001c000000200000006e00000092000000ee000000f10100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000101000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb020000000000000000000000c399495011b912999dbc72cf54982924e328ae170654ef76c8aba190ca376307000000000000000000000000c317d0b0b2a513ab1206e6d454c1960de7d7b4b80d0748a3e1f9cb197b74b8a501000000030100000c000000a20000009600000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d3500000010000000300000003100000082d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e01000000006100000010000000180000006100000064e5b27317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c00000018000000080000005207000000000000000000008f0100000c000000380000000000000000000000258e82bab2af21fd8899fc872742f4acea831f5e4c232297816b9bf4a19597a900000000570100001c000000200000006e000000b2000000e20000004b0100000000000002000000a563884b3686078ec7e7677a5f86449b15cf2693f3c1241766c6996f206cc5410200000000ace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708000000000102000000327f1fc62c53530c6c27018f1e8cee27c35c0370c3b4d3376daf8fe110e7d8cb4930ba433e606a53f4f283f02dddeb6d51b0dc3e463629b14a27995de9c71eca01000000ba08000000010020b1b547956a0dfb7ea618231563b3acd23607586e939f88e5a6db5f392b2e78d500000000690000000800000061000000100000001800000061000000c561436317000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d0c0000000800000000000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000e91c708e17000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d1c0000000c0000001800000008000000deadbeefdeadbeef00000000140000000c000000100000000000000000000000 --expectReject
  [ "$status" -eq 0 ]
  grep -q "<= b''6982" <(echo "$output")
  rejectionMessageCheck "Data found in non-dao cell"
}
